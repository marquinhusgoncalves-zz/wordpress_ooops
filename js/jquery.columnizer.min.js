!function(a){a.fn.columnize=function(b){function d(a,b){try{a.append(b)}catch(c){a[0].appendChild(b[0])}}this.cols=[],this.offset=0,this.before=[],this.lastOther=0,this.prevMax=0,this.debug=0,this.setColumnStart=null,this.elipsisText="";var c={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,precise:!1,manualBreaks:!1,cssClassPrefix:"",elipsisText:"...",debug:0};return b=a.extend(c,b),"string"==typeof b.width&&(b.width=parseInt(b.width,10),isNaN(b.width)&&(b.width=c.width)),"function"==typeof b.setColumnStart&&(this.setColumnStart=b.setColumnStart),"string"==typeof b.elipsisText&&(this.elipsisText=b.elipsisText),b.debug&&(this.debug=b.debug),b.setWidth||(b.setWidth=b.precise?function(a){return 100/a}:function(a){return Math.floor(100/a)}),this.each(function(){function n(a,b){var c=b?".":"";return k.length?c+k+"-"+a:c+a}function o(c,e,f,g){for(;(j||f.height()<g)&&e[0].childNodes.length;){var h=e[0].childNodes[0];if(a(h).find(n("columnbreak",!0)).length)return;if(a(h).hasClass(n("columnbreak")))return;d(c,a(h))}if(0!==c[0].childNodes.length){var i=c[0].childNodes,k=i[i.length-1];c[0].removeChild(k);var l=a(k);if(3==l[0].nodeType){var m=l[0].nodeValue,o=b.width/18;b.accuracy&&(o=b.accuracy);for(var p,q=null;f.height()<g&&m.length;){var r=m.indexOf(" ",o);p=-1!=r?m.substring(0,r):m,q=document.createTextNode(p),d(c,a(q)),m=m.length>o&&-1!=r?m.substring(r):""}if(f.height()>=g&&null!==q&&(c[0].removeChild(q),m=q.nodeValue+m),!m.length)return!1;l[0].nodeValue=m}return e.contents().length?e.prepend(l):d(e,l),3==l[0].nodeType}}function p(a,b,c,e){if(!a.contents(":last").find(n("columnbreak",!0)).length&&!a.contents(":last").hasClass(n("columnbreak"))&&b.contents().length){var f=b.contents(":first");if("undefined"==typeof f.get(0)||1!=f.get(0).nodeType)return;var g=f.clone(!0);if(f.hasClass(n("columnbreak")))d(a,g),f.remove();else if(j)d(a,g),f.remove();else if(1==g.get(0).nodeType&&!g.hasClass(n("dontend")))if(d(a,g),g.is("img")&&c.height()<e+20)f.remove();else if(f.hasClass(n("dontsplit"))&&c.height()<e+20)f.remove();else if(g.is("img")||f.hasClass(n("dontsplit")))g.remove();else{if(g.empty(),o(g,f,c,e))f.addClass(n("split"));else{if(f.addClass(n("split")),"OL"==f.get(0).tagName){var h=g.get(0).childElementCount+g.get(0).start;f.attr("start",h+1)}f.children().length&&p(g,f,c,e)}if(0===g.get(0).childNodes.length)g.remove(),f.removeClass(n("split"));else if(1==g.get(0).childNodes.length){var i=g.get(0).childNodes[0];if(3==i.nodeType){var k=/\s/,l=i.nodeValue;k.test(l)&&(g.remove(),f.removeClass(n("split")))}}}}}function q(){if(!e.data("columnized")||1!=e.children().length){if(e.data("columnized",!0),e.data("columnizing",!0),e.empty(),e.append(a("<div class='"+n("first")+" "+n("last")+" "+n("column")+" "+"' style='width:100%; float: "+b.columnFloat+";'></div>")),$col=e.children().eq(e.children().length-1),$destroyable=g.clone(!0),b.overflow){for(targetHeight=b.overflow.height,o($col,$destroyable,$col,targetHeight),$destroyable.contents().find(":first-child").hasClass(n("dontend"))||p($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&r($col.contents(":last").get(0));){var c=$col.contents(":last");c.remove(),$destroyable.prepend(c)}for(var f="",h=document.createElement("DIV");$destroyable[0].childNodes.length>0;){var i=$destroyable[0].childNodes[0];if(i.attributes)for(var j=0;j<i.attributes.length;j++)0===i.attributes[j].nodeName.indexOf("jQuery")&&i.removeAttribute(i.attributes[j].nodeName);h.innerHTML="",h.appendChild($destroyable[0].childNodes[0]),f+=h.innerHTML}var k=a(b.overflow.id)[0];k.innerHTML=f}else d($col,$destroyable.contents());e.data("columnizing",!1),b.overflow&&b.overflow.doneFunc&&b.overflow.doneFunc(),b.doneFunc()}}function r(b){return 3==b.nodeType?/^\s+$/.test(b.nodeValue)?b.previousSibling?r(b.previousSibling):!1:!1:1!=b.nodeType?!1:a(b).hasClass(n("dontend"))?!0:0===b.childNodes.length?!1:r(b.childNodes[b.childNodes.length-1])}function s(){if(l=0,h!=e.width()){h=e.width();var c=Math.round(e.width()/b.width),i=b.width,k=b.height;if(b.columns&&(c=b.columns),j&&(c=g.find(n("columnbreak",!0)).length+1,i=!1),1>=c)return q();if(!e.data("columnizing")){e.data("columnized",!0),e.data("columnizing",!0),e.empty(),e.append(a("<div style='width:"+b.setWidth(c)+"%; float: "+b.columnFloat+";'></div>")),y=e.children(":last"),d(y,g.clone()),f=y.height(),e.empty();var m=f/c,t=3,u=!1;b.overflow?(t=1,m=b.overflow.height):k&&i&&(t=1,m=k,u=!0);for(var v=0;t>v&&20>v;v++){e.empty();var w,x,y,z;try{w=g.clone(!0)}catch(A){w=g.clone()}w.css("visibility","hidden");for(var B=0;c>B;B++)x=0===B?n("first"):"",x+=" "+n("column"),x=B==c-1?n("last")+" "+x:x,e.append(a("<div class='"+x+"' style='width:"+b.setWidth(c)+"%; float: "+b.columnFloat+";'></div>"));for(B=0;B<c-(b.overflow?0:1)||u&&w.contents().length;){for(e.children().length<=B&&e.append(a("<div class='"+x+"' style='width:"+b.setWidth(c)+"%; float: "+b.columnFloat+";'></div>")),y=e.children().eq(B),u&&y.width(i+"px"),o(y,w,y,m),p(y,w,y,m);y.contents(":last").length&&r(y.contents(":last").get(0));)z=y.contents(":last"),z.remove(),w.prepend(z);B++,0===y.contents().length&&w.contents().length?y.append(w.contents(":first")):B!=c-(b.overflow?0:1)||b.overflow||w.find(n("columnbreak",!0)).length&&c++}if(b.overflow&&!u){var C=!1,D=document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.");if(C||D){for(var E="",F=document.createElement("DIV");w[0].childNodes.length>0;){var G=w[0].childNodes[0];for(B=0;B<G.attributes.length;B++)0===G.attributes[B].nodeName.indexOf("jQuery")&&G.removeAttribute(G.attributes[B].nodeName);F.innerHTML="",F.appendChild(w[0].childNodes[0]),E+=F.innerHTML}var H=a(b.overflow.id)[0];H.innerHTML=E}else a(b.overflow.id).empty().append(w.contents().clone(!0))}else if(u)e.children().each(function(a){y=e.children().eq(a),y.width(i+"px"),0===a?y.addClass(n("first")):a==e.children().length-1?y.addClass(n("last")):(y.removeClass(n("first")),y.removeClass(n("last")))}),e.width(e.children().length*i+"px");else{y=e.children().eq(e.children().length-1),w.contents().each(function(){y.append(a(this))}),y.height();var K=0,L=1e7,M=0,N=!1,O=0;e.children().each(function(a){return function(b){var c=a.children().eq(b),d=c.children(":last").find(n("columnbreak",!0)).length;if(!d){var e=c.height();N=!1,K+=e,e>M&&(M=e,N=!0),L>e&&(L=e),O++}}}(e));var P=K/O;0===K?v=t:b.lastNeverTallest&&N?(l+=5,m+=30,v==t-1&&t++):M-L>30?m=P+30:Math.abs(P-m)>20?m=P:v=t}e.append(a("<br style='clear:both;'>"))}e.find(n("column",!0)).find(":first"+n("removeiffirst",!0)).remove(),e.find(n("column",!0)).find(":last"+n("removeiflast",!0)).remove(),e.find(n("split",!0)).find(":first"+n("removeiffirst",!0)).remove(),e.find(n("split",!0)).find(":last"+n("removeiflast",!0)).remove(),e.data("columnizing",!1),b.overflow&&b.overflow.doneFunc(),b.doneFunc()}}}var e=b.target?a(b.target):a(this),f=a(this).height(),g=a("<div></div>"),h=0,j=b.manualBreaks,k=c.cssClassPrefix;"string"==typeof b.cssClassPrefix&&(k=b.cssClassPrefix);var l=0;if(d(g,a(this).contents().clone(!0)),!b.ignoreImageLoading&&!b.target&&!e.data("imageLoaded")&&(e.data("imageLoaded",!0),a(this).find("img").length>0)){var m=function(a,c){return function(){a.data("firstImageLoaded")||(a.data("firstImageLoaded","true"),d(a.empty(),c.children().clone(!0)),a.columnize(b))}}(a(this),g);return a(this).find("img").one("load",m),a(this).find("img").one("abort",m),void 0}e.empty(),s(),b.buildOnce||a(window).resize(function(){b.buildOnce||(e.data("timeout")&&clearTimeout(e.data("timeout")),e.data("timeout",setTimeout(s,200)))})})},a.fn.renumberByJS=function(b,c,d,e){if(this.setList=function(b,c,d){var f,e=this.before.parents();if(f=a(b[this.offset-1]).find(">*"),f.last()[0].tagName!=d.toUpperCase())return this.debug&&console.log("Last item in previous column, isn't a list..."),0;f=f.length;var g=1;if(g=this.lastOther<=0?this.before.children().length+1:a(e[this.lastOther]).children().length+1,a(b[this.offset]).find(d+":first li.split").length){var h=a(b[this.offset-1]).find(d+":last li:last");if(""===this.elipsisText||a(b[this.offset-1]).find(d+":last ~ div").length||a(b[this.offset-1]).find(d+":last ~ p").length);else if(0==a(h).find("ul, ol, dl").length){var i=h.last().text(),j=i.length;";"==i.substring(j-1)?i.substring(j-4)!=this.elipsisText+";"&&(i=i.substring(0,j-1)+this.elipsisText+";"):i.substring(j-3)!=this.elipsisText&&(i+=this.elipsisText),h.last().text(i)}0==a(b[this.offset]).find(d+":first >li.split >"+d).length&&g--}if(1==f&&(g+=this.prevMax),this.nest>1){this.debug&&console.log("Supposed to be a nested list...decr"),g--;var k=a(b[this.offset-1]).find(d+":first li.split:first");k.length>0&&(this.debug&&console.log("Previous column started with a split item, so that count is one less than expected"),g--),k=a(b[this.offset]).find(d+":first li:first").clone(),k.children().remove(),a.trim(k.text()).length>0&&(this.debug&&console.log("If that was a complete list in the previous column, don't decr."),g++,0==a(b[this.offset-1]).find(">"+d+":last ").children().length&&(this.debug&&console.log("unless that was empty, in which case revert"),g--))}else{var k=a(b[this.offset]).find(d+":first li:first "+d+".split li.split");k.length>0&&(this.debug&&console.log("[Nested] Column started with a split item, so that count is one less than expected"),g--)}return this.debug&&console.log("Setting the start value to "+g+" ("+this.prevMax+")"),g>0&&("function"==typeof this.setColumnStart?this.setColumnStart(c,g):c.attr("start",g)),0},"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1),!d&&!e)throw"renumberByJS(): Bad param, must pass an id or a class";var f="";this.prevMax=1,f=e?"."+e:"#"+d;var g=b.toLowerCase(),h=b.toUpperCase();for(this.cols=a(f),this.debug&&console.log("There are "+this.cols.length+" items, looking for "+g),this.before=a(this.cols[0]).find(g+":last"),this.prevMax=this.before.children().length,this.offset=1;this.offset<this.cols.length;this.offset++)if(this.debug&&console.log("iterating "+this.offset+"...[of "+this.cols.length+"]"),0!=this.offset%c){if(this.before=a(this.cols[this.offset-1]).find(g+":last"),this.before.length){this.debug&&console.log("Have some "+b+" elements in the previous column");var i=a(this.cols[this.offset]).find(g+":first"),j=a(this.cols[this.offset]).find("*:first");if(j[0]!==i[0])continue;var k=this.before.parents();this.lastOther=0;for(var l=!1;this.lastOther<k.length;this.lastOther++)if(k[this.lastOther].tagName!=h&&"LI"!=k[this.lastOther].tagName){l=!0,this.lastOther--;break}this.nest=1,a(this.cols[this.offset]).find(">"+g+":first li "+g+":first").length&&(this.nest=2),this.setList(this.cols,i,g),this.lastOther--,i=a(this.cols[this.offset]).find(g+":first li "+g+":first"),i.length&&(this.before=a(this.cols[this.offset-1]).find(">"+g+":last li "+g+":last"),this.prevMax=0,this.nest=1,this.setList(this.cols,i,g));var m=a(this.cols[this.offset-1]).find(">"+g+":last");this.prevMax=m.children().length}}else this.debug&&console.log("First column (in theory..)"),this.prevMax=1;return 0}}(jQuery);